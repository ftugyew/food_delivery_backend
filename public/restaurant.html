<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tindo ‚Äì Restaurant Menu</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="css/animations.css">
  <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body class="bg-gray-50 text-gray-800 font-sans">

  <!-- Header -->
  <header class="bg-green-600 text-white p-4 shadow-md flex justify-between items-center">
    <h1 class="text-2xl font-bold flex items-center gap-2">
      <i data-lucide="utensils"></i> Tindo Menu
    </h1>
    <div class="flex gap-3">
      <a href="cart.html" class="flex items-center gap-1 bg-white text-green-700 px-4 py-2 rounded-xl font-medium hover:bg-green-100 transition">
        <i data-lucide="shopping-cart"></i> Cart
      </a>
      <a href="index.html" class="flex items-center gap-1 border border-white px-4 py-2 rounded-xl hover:bg-green-500 transition">
        <i data-lucide="home"></i> Home
      </a>
    </div>
  </header>

  <!-- Restaurant Banner -->
  <section class="max-w-5xl mx-auto mt-8 bg-white shadow-lg rounded-2xl overflow-hidden flex flex-col md:flex-row items-center p-6">
    <img id="restaurant-image" src="images/placeholder.jpg" alt="Restaurant" class="w-full md:w-1/3 rounded-xl object-cover">
    <div class="md:ml-6 mt-4 md:mt-0">
      <h2 id="restaurant-name" class="text-3xl font-bold text-green-700 mb-2">Restaurant Name</h2>
      <p id="restaurant-desc" class="text-gray-600 mb-3">Authentic taste, hot and fresh meals served with love üíö</p>
      <p id="restaurant-eta" class="text-sm text-gray-500">‚è±Ô∏è 25-30 mins delivery</p>
    </div>
  </section>

  <!-- Menu Section -->
  <main class="max-w-5xl mx-auto mt-10 px-4">
    <h3 class="text-2xl font-semibold text-green-700 mb-6 flex items-center gap-2">
      <i data-lucide="list"></i> Menu
    </h3>

    <div id="menu-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>

    <!-- Empty Message -->
    <div id="no-dishes" class="text-center text-gray-500 text-lg py-10 hidden">
      No dishes available yet üçΩÔ∏è
    </div>

  </main>

  <!-- Floating Cart Button -->
  <a href="cart.html" class="fixed bottom-5 right-5 bg-green-600 hover:bg-green-700 text-white px-5 py-3 rounded-full shadow-lg flex items-center gap-2">
    <i data-lucide="shopping-bag"></i> View Cart
  </a>

  <!-- Footer -->
  <footer class="text-center mt-16 py-6 bg-gray-100 text-gray-500 text-sm">
    ¬© 2025 Tindo ‚Äì Mana Tindi, Mana App
  </footer>

  <script>
    lucide.createIcons();

    const restaurantId = new URLSearchParams(window.location.search).get('id');
    console.log('Debug: restaurantId from URL =', restaurantId);

    // Validate restaurantId before making API calls
    if (!restaurantId) {
      console.error("Error: Missing restaurantId in URL");
      document.getElementById('no-dishes').textContent = "Invalid restaurant ID üòî";
      document.getElementById('no-dishes').classList.remove('hidden');
    } else {
      // ===== Fetch restaurant info =====
      fetch(`http://localhost:5000/api/restaurants`)
        .then(res => res.json())
        .then(restaurants => {
          const rest = restaurants.find(r => r.id == restaurantId);
          if (rest) {
            document.getElementById('restaurant-name').textContent = rest.name;
            document.getElementById('restaurant-desc').textContent = rest.description || 'Delicious food from Tindo partner restaurant üç¥';
            document.getElementById('restaurant-eta').textContent = `‚è±Ô∏è ${rest.eta || 30} mins delivery`;
            document.getElementById('restaurant-image').src = rest.image_url?.startsWith('http')
              ? rest.image_url
              : `http://localhost:5000/uploads/${rest.image_url}`;
          } else {
            console.error("Error: Restaurant not found");
            document.getElementById('no-dishes').textContent = "Restaurant not found üòî";
            document.getElementById('no-dishes').classList.remove('hidden');
          }
        })
        .catch(err => {
          console.error("Error fetching restaurant info:", err);
          document.getElementById('no-dishes').textContent = "Failed to load restaurant info üòî";
          document.getElementById('no-dishes').classList.remove('hidden');
        });

      // ===== Fetch menu for this restaurant =====
      console.log("Debug: Fetching menu for restaurantId =", restaurantId);

      // Handle non-JSON responses gracefully
      fetch(`http://localhost:5000/api/menu/by-restaurant/${restaurantId}`)
        .then(res => {
          console.log("Debug: Menu API response status =", res.status);
          if (!res.ok) {
            throw new Error(`HTTP error! status: ${res.status}`);
          }
          return res.json();
        })
        .then(dishes => {
          console.log("Debug: Dishes fetched =", dishes);
          const menuList = document.getElementById('menu-list');
          const emptyMsg = document.getElementById('no-dishes');
          if (!dishes.length) {
            emptyMsg.textContent = "No dishes available yet üçΩÔ∏è";
            emptyMsg.classList.remove('hidden');
            return;
          }
          dishes.forEach(dish => {
            const card = document.createElement('div');
            card.className = "bg-white p-4 rounded-xl shadow hover:shadow-lg transition border border-gray-100 relative group";
            card.innerHTML = `
              ${dish.image_url ? `<img src="http://localhost:5000/uploads/${dish.image_url}" class="w-full h-44 object-cover rounded-xl mb-3">` : `<div class="w-full h-44 bg-gray-200 rounded-xl mb-3 flex items-center justify-center text-gray-500">No Image</div>`}
              <h4 class="text-lg font-semibold text-green-700">${dish.item_name}</h4>
              <p class="text-gray-600 mb-2">${dish.description || ''}</p>
              <p class="text-green-700 font-bold text-lg mb-2">‚Çπ${dish.price}</p>
              <button onclick="addToCart('${dish.item_name}', ${dish.price}, '${dish.image_url || ''}')" class="bg-green-600 text-white px-4 py-2 rounded-xl hover:bg-green-700 transition w-full">Add to Cart</button>
            `;
            menuList.appendChild(card);
          });
        })
        .catch(err => {
          console.error("Error fetching menu:", err);
          document.getElementById('no-dishes').textContent = "Failed to load menu üòî";
          document.getElementById('no-dishes').classList.remove('hidden');
        });
    }

    function addToCart(item_name, price, image_url) {
      let cart = JSON.parse(localStorage.getItem('tindo_cart')) || [];
      const existing = cart.find(item => item.name === item_name);
      if (existing) {
        existing.qty += 1;
      } else {
        cart.push({ name: item_name, price, image_url, qty: 1 });
      }
      localStorage.setItem('tindo_cart', JSON.stringify(cart));
      alert(`${item_name} added to cart üõí`);
    }

    // ‚ù§Ô∏è Like
    function likeDish(btn) {
      btn.classList.toggle('text-red-500');
      btn.classList.toggle('text-gray-400');
    }

    // üëÅÔ∏è View Details Popup
    function viewDetails(name, desc, price, img) {
      const modal = document.createElement('div');
      modal.className = "fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50";
      modal.innerHTML = `
        <div class="bg-white p-6 rounded-2xl shadow-xl max-w-sm text-center relative">
          <img src="http://localhost:5000/uploads/${img}" class="w-full h-48 object-cover rounded-xl mb-3">
          <h3 class="text-xl font-bold text-green-700 mb-1">${name}</h3>
          <p class="text-gray-600 mb-2">${desc || ''}</p>
          <p class="text-green-700 font-bold text-lg mb-4">‚Çπ${price}</p>
          <button onclick="this.parentElement.parentElement.remove()" class="bg-green-600 text-white px-6 py-2 rounded-xl hover:bg-green-700 transition">Close</button>
        </div>
      `;
      document.body.appendChild(modal);
    }

    // Remove Proceed to Payment button
    const proceedToPaymentBtn = document.querySelector('button.bg-green-600.text-white.px-5.py-3.rounded-xl.hover\:bg-green-700.transition.w-full.mt-4');
    if (proceedToPaymentBtn) proceedToPaymentBtn.remove();
  </script>
</body>
</html>
